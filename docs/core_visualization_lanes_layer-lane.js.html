<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: core/visualization/lanes/layer-lane.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: core/visualization/lanes/layer-lane.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import BaseLane from './base-lane.js'

const S = 45
const L = 40            


/**
 * Layer 泳道子类 （TimeStep 可视化）
 * @extends BaseLane
 */
export default class LayerLane extends BaseLane {
  constructor() {
    super('Layer', 'timestep_type')
    // 每个 timestep 已用 cycle 偏移量
    this.innerOffset = new Map() // 仅记录 ts 内已用 cycle
  }

  /**
  *把单条 entry -> 0 或多个矩形段
  * @param {Array&lt;Object>} entry
  * @return {Array&lt;Object>} 矩形段对象数组
  */
  parseSegments(entry) {
    if (entry.timestep_type !== 'layer') return []
    const ts = entry.timestep
    const off = this.innerOffset.get(ts) || 0
    const wid = entry.cycle || 1
    this.innerOffset.set(ts, off + wid)
    
    /* 先拿到全局坐标 */
    const seg = this.makeSegment(ts, off, wid, {
      name: `${entry.op}(${entry.tensor_name})`,
      raw: entry,
      op: entry.op
    });

    /* 立即写回 entry，供 dep-collector 用 */
    entry._cycStart = seg.cycStart;
    entry._cycEnd   = seg.cycEnd;

    return [seg];
  }

  
  /**
   * 决定矩形颜色
   * @param {Object} segment  矩形对应的段对象
   * @returns {string} 颜色字符串，如 '#7b9ce1'
   */
  getColor(segment) {
    const name = segment.name || 'unknown'
    let hash = 0
    for (let i = 0; i &lt; name.length; i++) {
      hash = ((hash &lt;&lt; 5) - hash + name.charCodeAt(i)) >>> 0
    }
    const hue = (hash % 1000) / 1000 * 360
    return `hsla(${hue}, ${S}%, ${L}%, 0.75)`
  }

  /**
   * 控制矩形上需显示的标签文字
   * @param {Object} segment 
   * @returns {string} 标签文字
   */
  getLabel(segment){
    const e = segment.raw;
    return `${e.op}  ts${e.timestep}`;
  }

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="EChartsManager.html">EChartsManager</a></li><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#TYPE_MAP">TYPE_MAP</a></li><li><a href="global.html#bankColor">bankColor</a></li><li><a href="global.html#buildDeps">buildDeps</a></li><li><a href="global.html#buildGlobalTimeAxis">buildGlobalTimeAxis</a></li><li><a href="global.html#buildSummaryOption">buildSummaryOption</a></li><li><a href="global.html#buildTimeStepOption">buildTimeStepOption</a></li><li><a href="global.html#collectProducers">collectProducers</a></li><li><a href="global.html#createColorMap">createColorMap</a></li><li><a href="global.html#createLane">createLane</a></li><li><a href="global.html#eventBus">eventBus</a></li><li><a href="global.html#genProfileOption">genProfileOption</a></li><li><a href="global.html#generateLmemOption">generateLmemOption</a></li><li><a href="global.html#getColor">getColor</a></li><li><a href="global.html#getHeightRatio">getHeightRatio</a></li><li><a href="global.html#getLabel">getLabel</a></li><li><a href="global.html#makeSegment">makeSegment</a></li><li><a href="global.html#makeSegmentAbsolute">makeSegmentAbsolute</a></li><li><a href="global.html#parseSegments">parseSegments</a></li><li><a href="global.html#setSharedConfig">setSharedConfig</a></li><li><a href="global.html#sharedConfig">sharedConfig</a></li><li><a href="global.html#toSeriesOption">toSeriesOption</a></li><li><a href="global.html#useProfileTableData">useProfileTableData</a></li><li><a href="global.html#useTableData">useTableData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Oct 22 2025 21:30:01 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
